<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visor de Skin 3D</title>
<style>
  body { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; background:#f0f0f0; font-family:sans-serif; }
  canvas { border:1px solid #ccc; margin-bottom:10px; }
  button, input { margin:5px; padding:5px 10px; font-size:14px; }
</style>
</head>
<body>

<canvas id="skinViewer" width="400" height="600"></canvas>

<input type="file" id="uploadSkin" accept="image/png">
<div>
  <button id="undoBtn">Undo</button>
  <button id="redoBtn">Redo</button>
</div>

<script type="module">
import { View, WalkingAnimation } from 'https://cdn.jsdelivr.net/npm/skinview3d@2.0.0-alpha.10/dist/skinview3d.min.js';

const canvas = document.getElementById('skinViewer');
const viewer = new View({
  canvas: canvas,
  width: 400,
  height: 600,
  skin: 'assets/tu_skin.png'
});
viewer.autoRotate = true;
viewer.animation = new WalkingAnimation();

// Historial de rotación para Undo/Redo
let history = [];
let historyIndex = -1;

// Guardar estado de rotación
function saveRotation() {
  history = history.slice(0, historyIndex + 1);
  history.push(viewer.rotation.clone());
  historyIndex++;
}
saveRotation();

// Undo
document.getElementById('undoBtn').addEventListener('click', () => {
  if(historyIndex > 0) {
    historyIndex--;
    const r = history[historyIndex];
    viewer.rotation.set(r.x, r.y, r.z);
  }
});

// Redo
document.getElementById('redoBtn').addEventListener('click', () => {
  if(historyIndex < history.length - 1) {
    historyIndex++;
    const r = history[historyIndex];
    viewer.rotation.set(r.x, r.y, r.z);
  }
});

// Animación de rotación automática
function animate() {
  viewer.rotation.y += 0.01;
  requestAnimationFrame(animate);
}
animate();

// Zoom con rueda del ratón
canvas.addEventListener('wheel', (e) => {
  e.preventDefault();
  viewer.camera.position.z += e.deltaY * 0.01;
  if(viewer.camera.position.z < 1) viewer.camera.position.z = 1;
  if(viewer.camera.position.z > 10) viewer.camera.position.z = 10;
});

// Cargar skin desde archivo y previsualizar correctamente
document.getElementById('uploadSkin').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if(file) {
    const reader = new FileReader();
    reader.onload = () => {
      const img = new Image();
      img.src = reader.result;
      img.onload = () => {
        viewer.loadSkin(img.src);
      };
    };
    reader.readAsDataURL(file);
  }
});
</script>

</body>
</html>
